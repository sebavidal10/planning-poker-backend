
> planning-poker-backend@1.0.0 test
> jest --coverage tests/integration.test.js

  console.log
    Mounting roomRoutes

      at Object.log (routes/roomRoutes.js:17:9)

  console.log
    createRoomSchema defined: true

      at Object.log (routes/roomRoutes.js:18:9)

  console.log
    validate middleware defined: true

      at Object.log (routes/roomRoutes.js:19:9)

  console.error
    Error: Error: Room not found
        at exports.getRoomDetails (/Users/sebavidal/Workspace/sebavidal10/planning-poker/planning-poker-backend/controllers/roomController.js:62:21)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 404
    }

      1 | const errorHandler = (err, req, res, next) => {
    > 2 |   console.error('Error:', err); // Log internally
        |           ^
      3 |
      4 |   const statusCode = err.statusCode || 500;
      5 |   const message = err.message || 'Internal Server Error';

      at error (middlewares/errorHandler.js:2:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (controllers/roomController.js:117:5)

  console.error
    Error: Error: Room not found
        at exports.closeRoom (/Users/sebavidal/Workspace/sebavidal10/planning-poker/planning-poker-backend/controllers/roomController.js:43:21)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 404
    }

      1 | const errorHandler = (err, req, res, next) => {
    > 2 |   console.error('Error:', err); // Log internally
        |           ^
      3 |
      4 |   const statusCode = err.statusCode || 500;
      5 |   const message = err.message || 'Internal Server Error';

      at error (middlewares/errorHandler.js:2:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (controllers/roomController.js:52:5)

  console.error
    Error: Error: Room not found
        at exports.deleteVotes (/Users/sebavidal/Workspace/sebavidal10/planning-poker/planning-poker-backend/controllers/roomController.js:128:21)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 404
    }

      1 | const errorHandler = (err, req, res, next) => {
    > 2 |   console.error('Error:', err); // Log internally
        |           ^
      3 |
      4 |   const statusCode = err.statusCode || 500;
      5 |   const message = err.message || 'Internal Server Error';

      at error (middlewares/errorHandler.js:2:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    Error: Error: Room not found
        at exports.selectVote (/Users/sebavidal/Workspace/sebavidal10/planning-poker/planning-poker-backend/controllers/voteController.js:13:21)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 404
    }

      1 | const errorHandler = (err, req, res, next) => {
    > 2 |   console.error('Error:', err); // Log internally
        |           ^
      3 |
      4 |   const statusCode = err.statusCode || 500;
      5 |   const message = err.message || 'Internal Server Error';

      at error (middlewares/errorHandler.js:2:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.log
    MongoDB disconnected

      at NativeConnection.log (config/db.js:30:11)
          at async Promise.all (index 0)

PASS tests/integration.test.js
  Backend Integration Tests
    POST /rooms
      ✓ should create a room successfully (218 ms)
      ✓ should fail with 400 if slug missing (5 ms)
    GET /rooms/:slug
      ✓ should get room details (10 ms)
      ✓ should return 404 if room not found (15 ms)
    PATCH /rooms/:slug/close
      ✓ should close a room (9 ms)
      ✓ should return 404 if room not found (7 ms)
    DELETE /rooms/:votingInstanceName
      ✓ should delete votes (7 ms)
      ✓ should return 404 if room not found (5 ms)
    POST /votes/selectVote
      ✓ should select a vote (10 ms)
      ✓ should return 404 if room not found (6 ms)
      ✓ should update existing vote (8 ms)

--------------------|---------|----------|---------|---------|--------------------
File                | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s  
--------------------|---------|----------|---------|---------|--------------------
All files           |   61.69 |     30.5 |   42.85 |   62.55 |                    
 controllers        |   87.36 |     62.5 |      50 |   89.24 |                    
  roomController.js |   85.07 |    58.33 |   44.44 |   87.69 | 27,74-75,91,99-103 
  voteController.js |   92.85 |       75 |   66.66 |   92.85 | 30,35              
 middlewares        |      92 |       60 |     100 |   91.66 |                    
  errorHandler.js   |     100 |       50 |     100 |     100 | 4-10               
  schemas.js        |     100 |      100 |     100 |     100 |                    
  validate.js       |   83.33 |      100 |     100 |   81.81 | 24-25              
 models             |     100 |      100 |     100 |     100 |                    
  Participant.js    |     100 |      100 |     100 |     100 |                    
  Room.js           |     100 |      100 |     100 |     100 |                    
  UserVote.js       |     100 |      100 |     100 |     100 |                    
 routes             |     100 |      100 |     100 |     100 |                    
  roomRoutes.js     |     100 |      100 |     100 |     100 |                    
  voteRoutes.js     |     100 |      100 |     100 |     100 |                    
 services           |    12.9 |     6.06 |   16.66 |   13.18 |                    
  socketService.js  |    12.9 |     6.06 |   16.66 |   13.18 | 9-43,56-204,212    
--------------------|---------|----------|---------|---------|--------------------
Test Suites: 1 passed, 1 total
Tests:       11 passed, 11 total
Snapshots:   0 total
Time:        1.551 s, estimated 2 s
Ran all test suites matching tests/integration.test.js.
